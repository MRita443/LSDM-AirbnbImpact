PREFIX : <http://example.org/nyc-vkg#>

SELECT ?neighborhoodName
       (AVG(?score) AS ?avgScore)
       (COUNT(DISTINCT ?crime) AS ?crimeCount)
WHERE {

  ?neighborhood :name ?neighborhoodName .

  ?listing a :AirbnbListing ;
           :location_score ?score ;
           :number_of_reviews ?number_of_reviews ;
           :locatedIn ?neighborhood .

  FILTER(?number_of_reviews > 10)

  OPTIONAL {
    ?crime a :CriminalComplaint ;
           :locatedIn ?neighborhood ;
           :offense_level "FELONY" .
  }
}
GROUP BY ?neighborhoodName
HAVING(AVG(?score) > 9)
ORDER BY DESC(?crimeCount) DESC(?avgScore)